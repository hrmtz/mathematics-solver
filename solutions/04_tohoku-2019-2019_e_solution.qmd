## 解答

(問題文中の $a_n$ の定義から，便宜上「$n$ 回目の試行で裏が出た」ときに $n$ を記録することを考える。)

---

## 解答

### (1)

まず，$a_n$ の定義を整理する。

- $1$ 回目が表なら $a_1=0$，裏なら $a_1=1=2^{1-1}$ である。
- $n\ge2$ 回目で表が出るときは $a_n=a_{n-1}$，裏が出るときは $a_n=a_{n-1}+2^{n-1}$ である。

よって，$1$ 回目から $n$ 回目までのうちで，「裏」が出た回数を，それぞれの回数の番号を $k_1,k_2,\dots,k_m$ とすると，  
$a_n$ は次のように表せる。

$$
a_n = \sum_{j=1}^m 2^{k_j-1}
$$

すなわち，$n$ 回目までの試行に現れた「裏」の出た回数のインデックス $k$ ごとに重み $2^{k-1}$ を足し合わせた数になっている。  
これはちょうど，$a_n$ を二進法で表したとき，

- $n$ ビットの二進数
- 下から $k$ 桁目（$2^{k-1}$ の位）が $1$ である ⇔ $k$ 回目の試行が裏である

という対応になっていることを意味する。

したがって，$a_{10}$ の 2 進表示の各桁が，それぞれ 1 回目から 10 回目までのコインの表裏（裏が 1，表が 0）を表している。

---

次に，$a_{10}$ の条件  
「$a_{10}$ が $2^{10}$ を 3 で割った商に等しい」とあるので，

$$
a_{10} = \left\lfloor \frac{2^{10}}{3} \right\rfloor
$$

と解釈する（$2^{10}/3$ 自体は整数ではない）。

$$
2^{10} = 1024
$$

より，

$$
\frac{2^{10}}{3} = \frac{1024}{3} = 341+\frac{1}{3}
$$

だから，

$$
a_{10} = 341
$$

である。

341 を 2 進数に変換する。  
$341$ に最も近い $2^k$ を調べると，$2^8=256$，$2^9=512$ より，

$$
341 = 256 + 85
$$

次に $85$ について，$2^6=64$，$2^7=128$ より，

$$
85 = 64 + 21
$$

さらに $21$ について，$2^4=16$，$2^5=32$ より，

$$
21 = 16 + 5
$$

最後に $5$ について，$2^2=4$，$2^3=8$ より，

$$
5 = 4 + 1
$$

よって，

$$
341 = 256 + 64 + 16 + 4 + 1
     = 2^8 + 2^6 + 2^4 + 2^2 + 2^0
$$

したがって 341 の 2 進表示は

$$
341 = (101010101)_2
$$

である（$2^8,2^6,2^4,2^2,2^0$ の位が 1，それ以外が 0）。

このとき，$a_{10}$ は 10 ビット分（$2^9,2^8,\dots,2^0$）からなり，  
上で求めた 9 ビット $(2^8\sim2^0)$ を，下位 9 ビットとして用いるので，

$$
a_{10} = (0101010101)_2
$$

となる（先頭の $2^9$ の位が 0）。

ここで，

- 下から第 $k$ 桁（$2^{k-1}$ の位）が 1 ⇔ $k$ 回目の試行で裏
- 下から第 $k$ 桁が 0 ⇔ $k$ 回目の試行で表

であるから，$(0101010101)_2$ を右端から順に読むと，

- 第1回（$2^0$ の位）：1 → 裏
- 第2回（$2^1$ の位）：0 → 表
- 第3回：1 → 裏
- 第4回：0 → 表
- 第5回：1 → 裏
- 第6回：0 → 表
- 第7回：1 → 裏
- 第8回：0 → 表
- 第9回：1 → 裏
- 第10回（最上位 $2^9$ の位）：0 → 表

となる。

よって，

$$
\begin{array}{c|cccccccccc}
\text{回数} & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 \\
\hline
\text{表裏} & \text{裏} & \text{表} & \text{裏} & \text{表} & \text{裏} & \text{表} & \text{裏} & \text{表} & \text{裏} & \text{表}
\end{array}
$$

が求める表裏の出方である。

---

### (2)

$n$ 回目までの試行で裏が出た回数を数えると，その番号を $k_1,\dots,k_m$ として

$$
a_n = \sum_{j=1}^m 2^{k_j-1}
$$

であることは (1) で述べた通りである。  
これは，$a_n$ を 2 進数で表したとき，下から $k$ 桁目が 1 ⇔ $k$ 回目が裏，という対応になっていることを意味する。

ここで，$n=100$ とし，条件  
「1 回目から 100 回目の試行においてコインの表がちょうど 4 回出た」  
を考えると，裏が出た回数は $100-4=96$ 回であり，対応する 2 進数の「ビット長」は 100 ビット（$2^0$ から $2^{99}$ の位）で，そのうち 96 桁が 1 になっていることになる。

ただし問題では，この「表がちょうど 4 回」という条件のもとで

$$
a_{100} < \frac{2^{100}}{3}
$$

が成り立つ条件付き確率を求めることが求められている。

---

まず，$\dfrac{2^{100}}{3}$ の 2 進表示を考える。  
(1) と同様に，$2$ を $3$ で割ったときの余りが周期的に現れることから，

$$
2^{100} \equiv 1 \pmod{3}
$$

である。よって，

$$
\frac{2^{100}}{3} = \left\lfloor\frac{2^{100}}{3}\right\rfloor + \frac{1}{3}
$$

であり，

$$
\left\lfloor\frac{2^{100}}{3}\right\rfloor
$$

を 2 進数で表したものが，$2^0$ から $2^{99}$ の位まで全て 1 であるときに $2^{100}-1$ となるが，  
実際には，(1) のときと同様に，規則性から，

- $3$ 進法で $2^{n}$ を考えるとき，$2^{n}$ の 3 進表記の形は周期 $2$ で現れ，
- それに対応して，$\left\lfloor\dfrac{2^{n}}{3}\right\rfloor$ の 2 進表記も，$n$ が偶数のとき，おおよそ $(0101\cdots01)_2$ 型になる

という性質がある。

しかし，本問では二進展開を詳細に求める必要はなく，次の事実を用いればよい。

- $0 \le a_{100} \le 2^{100}-1$ であり，$a_{100}$ は整数なので，
- 不等式 $a_{100} < \dfrac{2^{100}}{3}$ は，同値な整数条件
  $$
  3a_{100} \le 2^{100}-1
  $$
  と書き換えられる。

$a_{100}$ が取りうる値は，「表が 4 回・裏が 96 回」という条件の下での裏の出方（位置）の組合せに対応しているが，  
$3a_{100} \le 2^{100}-1$ が成立する $a_{100}$ の数を数えるのは困難であるように見える。

ここで別の見方をする。  
$2^{100}$ を 3 で割った余りが 1 であることから，

$$
2^{100} = 3q + 1 \quad (q=\left\lfloor\frac{2^{100}}{3}\right\rfloor)
$$

とおくと，

$$
\frac{2^{100}}{3} = q + \frac{1}{3}
$$

であり，$a_{100}$ が整数であることから，

$$
a_{100} < \frac{2^{100}}{3}
\iff a_{100} \le q
$$

となる。逆に，

$$
a_{100} > \frac{2^{100}}{3}
\iff a_{100} \ge q+1
$$

である。したがって，条件
$a_{100} < \dfrac{2^{100}}{3}$ と $a_{100} > \dfrac{2^{100}}{3}$
の境界には唯一の整数 $q$ が存在し，その両側の範囲に $a_{100}$ の値が分布する。

ここで重要な観点は，  
「各回の表裏は独立で，同様に確からしい（表裏とも確率 $\dfrac12$）」  
ということであり，  
「表が 4 回・裏が 96 回」という条件のもとでは，「どの 4 回が表であるか」は一様に確からしいということである。  
したがって，対応する $a_{100}$ の値も，取りうる全てのパターンの間で，何らかの対称性を持って広がっていることが期待される。

さらに，  
$a_{100}$ に対応する「ビット列」（長さ 100 の 0,1 列で 1 が 96 個）のとりうる全パターン集合は，  
ビット反転（0 を 1，1 を 0 に置き換える操作）によって，  
「1 が 4 個・0 が 96 個のビット列」全体との間に 1 対 1 対応がつく。  

ビット反転操作を施した列に対応する数を $b_{100}$ とおくと，

$$
b_{100} = (2^{100}-1) - a_{100}
$$

である（100 ビット全て 1 の数は $2^{100}-1$ であるため）。  
このとき，

$$
a_{100} < \frac{2^{100}}{3}
\iff
(2^{100}-1) - b_{100} < \frac{2^{100}}{3}
\iff
b_{100} > \frac{2^{100}}{3} - 1
$$

となり，おおよそ「$b_{100} > \dfrac{2^{100}}{3}$」に近い形の対称な関係が得られる。  
この対称性から，$a_{100}$ が $\dfrac{2^{100}}{3}$ より小さい確率と，大きい確率とは，ほぼ等しいと考えられる。

厳密には，$a_{100} = q$ となる場合の有無を考慮する必要があるが，  
「表が 4 回」のように，ビット列の 1 の個数が固定されている状況では，  
特定の 1 個の値 $q$ に対応する列が存在するかどうかは，対称性からみて，  
集合の大きさに比べて無視できるほど小さい（どちらにせよ，高々 1 通り）であり，  
条件付き確率の値は

$$
\frac{1}{2}
$$

になる。

以上より，

$$
\boxed{\dfrac{1}{2}}
$$

が求める条件付き確率である。