（玉の本数）赤15個，青10個，白5個なので，  
1回ごとの操作で  
赤の確率 $=\dfrac{15}{30}=\dfrac12$，  
青の確率 $=\dfrac{10}{30}=\dfrac13$，  
白の確率 $=\dfrac{5}{30}=\dfrac16$  
であることを最初に確認しておく。

---

### (1)

操作を $n$ 回繰り返し，白玉をちょうど1回だけ取り出したとする。

赤を $r$ 回，青を $b$ 回，白を $w$ 回取り出したとすると，
$$
r+b+w = n
$$
である。今回は $w=1$ なので
$$
r+b = n-1
$$
である。

このとき最終到達点の座標 $(X,Y)$ は，  
赤を1回取ると $(+1,0)$，青を1回取ると $(0,+1)$，白を1回取ると $(-1,-1)$  
だけ変化するから
$$
X = r - 1,\quad Y = b - 1
$$
となる。

$r+b=n-1$ より $b=n-1-r$ なので
$$
X = r-1,\quad Y = (n-1-r)-1 = n-2-r.
$$
これを $r$ で消去するために $r=X+1$ とおくと
$$
Y = n-2-(X+1) = n-3-X
$$
となる。

また，$r,b$ は 0 以上の整数であるから
$$
r=X+1\ge0,\quad b=n-1-r=n-2-X\ge0
$$
より
$$
-1\le X\le n-2
$$
である。このとき $Y=n-3-X$ は自動的に整数となる。

以上より，到達点となり得る点は
$$
X+Y = n-3,\quad -1\le X\le n-2
$$
を満たす格子点である。

---

### (2)

操作を $n$ 回行った後の到達点 $(X,Y)$ の条件を求める。

赤 $r$ 回，青 $b$ 回，白 $w$ 回とすると
$$
r+b+w=n
$$
であり，座標の変化から
$$
X = r-w,\quad Y = b-w
$$
である。これを用いて $r,b,w$ を $X,Y$ で表すと
$$
r = X+w,\quad b = Y+w
$$
だから
$$
r+b+w = (X+w)+(Y+w)+w = X+Y+3w = n
$$
となる。よって
$$
w = \frac{n-(X+Y)}{3}
$$
である。

$r,b,w$ はいずれも 0 以上の整数なので，これから

1. $n-(X+Y)$ が 3 の倍数である（$w$ が整数），
2. $w\ge0$ すなわち $X+Y\le n$，
3. $r=X+w\ge0,\ b=Y+w\ge0$ である。

$r,b\ge0$ を $X,Y$ の条件で書き直す。  
$r=X+w\ge0$ より
$$
X+w\ge0 \quad\Longleftrightarrow\quad X+\frac{n-(X+Y)}{3}\ge0
$$
両辺を3倍して整理すると
$$
3X + n - X -Y \ge 0
\quad\Longleftrightarrow\quad 2X - Y + n \ge 0
\quad\Longleftrightarrow\quad Y \le 2X + n.
$$
同様に $b=Y+w\ge0$ より
$$
3Y + n - X - Y \ge 0
\quad\Longleftrightarrow\quad 2Y - X + n \ge 0
\quad\Longleftrightarrow\quad X \le 2Y + n.
$$

さらに $w\ge0$ は
$$
\frac{n-(X+Y)}{3}\ge0
\quad\Longleftrightarrow\quad X+Y\le n.
$$

一方，$r+b\le n$ から $r+b = X+Y+2w\le n$ であるが
$r+b+w=n$ と合わせると $w\ge0$ と同値であり，既に含まれている。

到達点は上の諸条件を満たす格子点全体である。  
ここで，実際に取り得る $X,Y$ の範囲を素朴に考えると，

- $X$ は赤で $+1$，白で $-1$ ずつ変わるので，  
  最大は全て赤を取るとき $X=n$，  
  最小は全て白を取るとき $X=-n$。
- $Y$ は青で $+1$，白で $-1$ ずつ変わるので，  
  最大は全て青を取るとき $Y=n$，  
  最小は全て白を取るとき $Y=-n$。

実際には 3 種類の玉すべてを自由に取り得るので，  
$-n\le X\le n,\ -n\le Y\le n$ の格子点のある部分が到達可能である。

ここから，より簡単な条件付けを導く。  
$r,b,w\ge0$ かつ $r+b+w=n$ であるから，
$$
r\le n,\ b\le n,\ w\le n
$$
が成り立つ。$X=r-w,\ Y=b-w$ なので
$$
X \ge -w \ge -n,\quad X \le r \le n,
$$
よって $-n\le X\le n$，同様に $-n\le Y\le n$ が従う。

さらに，$r+b+w=n$ と $r=X+w,\ b=Y+w$ を用いて
$$
r+b = X+Y+2w = n-w
$$
であるから
$$
w = n-(r+b) \ge 0 \quad\Longleftrightarrow\quad r+b\le n
$$
である。ここで  
$r\ge0,\ b\ge0,\ r+b\le n$ を $X,Y$ で表すと
$$
r=X+w\ge0,\ b=Y+w\ge0,\ r+b\le n
$$
であり，$w=(n-(X+Y))/3$ を代入して整理していくと，
上で得た
$$
X+Y\le n,\quad Y\le 2X+n,\quad X\le 2Y+n
$$
の 3 条件と同値になる。

この 3 本の直線
$$
X+Y = n,\quad Y = 2X+n,\quad X = 2Y+n
$$
で囲まれる三角形の内部または辺上の格子点が到達点である。
この三角形の頂点は，式を連立して求めると
$$
(0,n),\quad (n,0),\quad (-n,-n)
$$
である。

よって，この三角形内の格子点の個数を求めればよい。

この三角形は，頂点 $(0,0),(n,0),(0,n)$ を持つ直角二等辺三角形を
原点中心に平行移動したものと同じ形であり，格子点の個数は
有名な結果として
$$
1 + 2 + \cdots + (n+1) = \frac{(n+1)(n+2)}{2}
$$
となる（例えば $X\ge Y\ge 0,\ X+Y\le n$ などの形に移せば直ちに分かる）。

したがって，操作を $n$ 回繰り返したとき，到達点となり得る点の個数は
$$
\frac{(n+1)(n+2)}{2}
$$
である。

---

### (3)

正方形 $D$ は，頂点が $(1,1),(-1,1),(-1,-1),(1,-1)$ なので，
辺上および内部の点は不等式で
$$
-1\le X\le 1,\quad -1\le Y\le 1
$$
と表される。

$n=3$ のときの到達点の個数は (2) より
$$
\frac{(3+1)(3+2)}{2} = \frac{4\cdot 5}{2} = 10
$$
である。

次に，そのうち $D$ の内部または辺上にあるものを数える。

$n=3$ 回の操作で $(X,Y)$ に到達するには，  
赤 $r$ 回，青 $b$ 回，白 $w$ 回で
$$
r+b+w=3,\quad X=r-w,\quad Y=b-w
$$
である。

$r,b,w$ の取り方をすべて挙げると

- $(r,b,w)=(3,0,0)$：$(X,Y)=(3,0)$
- $(2,1,0)$：$(2,1)$
- $(2,0,1)$：$(1,-1)$
- $(1,2,0)$：$(1,2)$
- $(1,1,1)$：$(0,0)$
- $(1,0,2)$：$(-1,-2)$
- $(0,3,0)$：$(0,3)$
- $(0,2,1)$：$(-1,1)$
- $(0,1,2)$：$(-2,-1)$
- $(0,0,3)$：$(-3,-3)$

の 10 通りである。

このうち $D$ の内部または辺上にあるのは
$$
(1,-1),\ (0,0),\ (-1,1)
$$
の 3 点である（いずれも $-1\le X\le1,\ -1\le Y\le1$）。

したがって，$P_3$ は
$$
P_3 = \frac{3}{10}
$$
である。

---

### (4)

$n=3N$ 回操作したときの確率 $P_{3N}$ を求める。

(2) の議論より，到達点 $(X,Y)$ は
$$
r+b+w=3N,\quad X=r-w,\quad Y=b-w,\quad r,b,w\ge0
$$
によって与えられる。これを変形して

- $X+Y = r+b-2w$
- $X-Y = r-b$

などとも書けるが，ここでは (2) と同じく $w$ を消去する形を用いる。

$$
w = \frac{3N-(X+Y)}{3} = N - \frac{X+Y}{3}
$$
であるから，$w$ が整数であるために
$$
X+Y \equiv 0 \pmod{3}
$$
が必要である。また $w\ge0$ より
$$
X+Y\le 3N.
$$

さらに $r=X+w\ge0,\ b=Y+w\ge0$ から (2) のときと同様に
$$
X+Y\le 3N,\quad Y\le 2X+3N,\quad X\le 2Y+3N
$$
が成り立つ。

この 3 条件は，$n$ を $3N$ に置き換えたものであり，  
到達点の全体は，頂点
$$
(0,3N),\ (3N,0),\ (-3N,-3N)
$$
をもつ三角形の内部または辺上の格子点のうち，
さらに
$$
X+Y\equiv 0\pmod{3}
$$
を満たすものに限られる。

一方，正方形 $D$ は $-1\le X\le1,\ -1\le Y\le1$ なので，
そこにある格子点は
$$
(-1,-1),\ (-1,0),\ (-1,1),\ (0,-1),\ (0,0),\ (0,1),\ (1,-1),\ (1,0),\ (1,1)
$$
の 9 点である。

これらが $3N$ 回の操作で到達可能かどうかを調べる。

まず，(2) の到達可能条件から $X+Y\le 3N$ は $|X|,|Y|\le1$ なので常に満たす。  
問題は $w=N-(X+Y)/3$ が非負整数になるかどうかである。

各点について $X+Y$ と $w$ を計算すると

- $(-1,-1)$：$X+Y=-2$，$w=N-\dfrac{-2}{3}=N+\dfrac23$（整数でない）
- $(-1,0)$：$X+Y=-1$，$w=N+\dfrac13$（整数でない）
- $(-1,1)$：$X+Y=0$，$w=N$
- $(0,-1)$：$X+Y=-1$，$w=N+\dfrac13$（整数でない）
- $(0,0)$：$X+Y=0$，$w=N$
- $(0,1)$：$X+Y=1$，$w=N-\dfrac13$（整数でない）
- $(1,-1)$：$X+Y=0$，$w=N$
- $(1,0)$：$X+Y=1$，$w=N-\dfrac13$（整数でない）
- $(1,1)$：$X+Y=2$，$w=N-\dfrac23$（整数でない）

よって，到達し得るのは
$$
(-1,1),\ (0,0),\ (1,-1)
$$
の 3 点のみである。これは $n=3$ のときと同じ 3 点であるが，
$w=N$ となっているので，$N$ がどの自然数であっても到達可能である。

したがって，$3N$ 回操作したとき，
$D$ の内部または辺上にある到達点の個数は常に 3 個である。

一方，(2) より，$n=3N$ 回操作したときの到達点の総数は
$$
\frac{(3N+1)(3N+2)}{2}
$$
である。

よって，
$$
P_{3N}
= \frac{\text{（$D$ 内部または辺上の到達点の個数）}}{\text{到達点の総数}}
= \frac{3}{\dfrac{(3N+1)(3N+2)}{2}}
= \frac{6}{(3N+1)(3N+2)}
$$
となる。

以上より
$$
P_{3N} = \frac{6}{(3N+1)(3N+2)}
$$
である。