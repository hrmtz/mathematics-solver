立方体の頂点を  
下底：$A(0,0,0),B(1,0,0),C(1,1,0),D(0,1,0)$  
上底：$E(0,0,1),F(1,0,1),G(1,1,1),H(0,1,1)$  
とおき，各辺の長さが1，速さも1なので，「時刻」と「移動した辺の本数」は一致する。

よって，時刻 $n$ に頂点 $P$ にいるとは，「ちょうど $n$ 本の辺を通って $P$ に到着している」ことと同値である。また，どの頂点でも，出ていく辺は 3 本あり，確率 $1/3$ ずつで選ばれる（頂点でとどまらない）。

以下，$p_n$ を「時刻 $n$ に頂点 $A$ にいる確率」とする。同様に，$b_n,c_n,d_n,e_n,f_n,g_n,h_n$ をそれぞれ $B,C,D,E,F,G,H$ にいる確率とする。

なお，問題の対称性から，$B,C,D$ は対称，$E,F,G,H$ も対称であることを用いる。

---

### (1)

#### 準備：対称性による簡略化

対称性より  
$$
b_n=c_n=d_n=:x_n,\qquad e_n=f_n=g_n=h_n=:y_n
$$
とおける。確率の和は常に1であるから  
$$
p_n+3x_n+4y_n=1 \quad(\forall n)
$$
である。

各頂点からの遷移を考える。

- $A$ からは，$B,D,E$ へそれぞれ確率 $1/3$ で移動する。
- $B$ からは，$A,C,F$ へ
- $C$ からは，$B,D,G$ へ
- $D$ からは，$A,C,H$ へ  
- $E$ からは，$A,F,H$ へ
- $F$ からは，$B,E,G$ へ
- $G$ からは，$C,F,H$ へ
- $H$ からは，$D,E,G$ へ

これから，$p_n,x_n,y_n$ の漸化式を立てる。

#### 頂点Aにいる確率 $p_n$ の漸化式

時刻 $n+1$ に $A$ にいるには，時刻 $n$ に $B,D,E$ のいずれかにいて，そこから $A$ を選ぶ必要がある。よって

$$
p_{n+1}=\frac13(b_n+d_n+e_n)
       =\frac13(2x_n+y_n)
$$

#### $x_n,y_n$ の漸化式

同様に，例えば $B$ について

- $A$ から $B$ へ：確率 $1/3$，
- $C$ から $B$ へ：確率 $1/3$，
- $F$ から $B$ へ：確率 $1/3$

なので

$$
b_{n+1}=\frac13(p_n+c_n+f_n)=\frac13(p_n+x_n+y_n)
$$

同じ対称性により $c_{n+1}=d_{n+1}=b_{n+1}$ なので $x_{n+1}=b_{n+1}$，すなわち

$$
x_{n+1}=\frac13(p_n+x_n+y_n)
$$

同様に，例えば $E$ について

$$
e_{n+1}=\frac13(p_n+f_n+h_n)=\frac13(p_n+2y_n)
$$

対称性から $y_{n+1}=e_{n+1}$，したがって

$$
y_{n+1}=\frac13(p_n+2y_n)
$$

ここで，$p_n+3x_n+4y_n=1$ を用いて，$x_n$ を消去する。

$$
x_n=\frac{1-p_n-4y_n}{3}
$$

これを $p_{n+1}$ の式に代入する。

$$
\begin{aligned}
p_{n+1}
&=\frac13\left(2x_n+y_n\right)
=\frac13\left(2\cdot\frac{1-p_n-4y_n}{3}+y_n\right)\\
&=\frac13\left(\frac{2-2p_n-8y_n}{3}+y_n\right)
=\frac13\left(\frac{2-2p_n-8y_n+3y_n}{3}\right)\\
&=\frac13\cdot\frac{2-2p_n-5y_n}{3}
=\frac{2-2p_n-5y_n}{9}
\end{aligned}
$$

さらに，$y_{n+1}=\dfrac13(p_n+2y_n)$ もあるので，これら 2 本の漸化式が得られる。

初期条件は，時刻 0 で $A$ にいるので

$$
p_0=1,\quad x_0=0,\quad y_0=0
$$

である。

#### 実際に $p_4,p_5$ を求める

まず $n=0,1,2,\dots$ と順に計算する。

- $n=0$ から $n=1$ へ

$$
\begin{aligned}
p_1&=\frac{2-2p_0-5y_0}{9}=\frac{2-2\cdot1-5\cdot0}{9}=0,\\
y_1&=\frac13(p_0+2y_0)=\frac13(1+0)=\frac13.
\end{aligned}
$$

確率の和より

$$
x_1=\frac{1-p_1-4y_1}{3}
=\frac{1-0-\frac{4}{3}}{3}
=\frac{-\frac13}{3}=-\frac19
$$

となるが，これは確率として不適であり，計算過程がおかしいことになる。  
（この矛盾から，$p_{n+1}$ の式の導出に誤りがあることに気付く必要がある。）

よって，もう一度，$p_{n+1}$ を正しく求め直す。

#### $p_{n+1}$ の正しい式

時刻 $n$ から $n+1$ へ，$A$ に来るのは $B,D,E$ からであり，それぞれ確率 $1/3$ で $A$ に移る。したがって

$$
p_{n+1}=\frac13(b_n+d_n+e_n)
$$

であるが，

$$
b_n=d_n=x_n,\quad e_n=y_n
$$

より

$$
p_{n+1}=\frac13(2x_n+y_n)
$$

までは正しい。

ところが，$x_n$ の式として用いた  
$$x_n=\frac{1-p_n-4y_n}{3}$$
は正しいが，ここに代入したあと，$p_{n+1}$ の簡約計算で誤りがあった。正しく計算し直す。

$$
\begin{aligned}
p_{n+1}
&=\frac13(2x_n+y_n)
=\frac13\left(2\cdot\frac{1-p_n-4y_n}{3}+y_n\right)\\
&=\frac13\left(\frac{2-2p_n-8y_n}{3}+y_n\right)
=\frac13\left(\frac{2-2p_n-8y_n+3y_n}{3}\right)\\
&=\frac13\cdot\frac{2-2p_n-5y_n}{3}
=\frac{2-2p_n-5y_n}{9}.
\end{aligned}
$$

この形自体は代数的には正しいが，上で初期条件を入れた際の「$x_1$ が負になる」という矛盾から，$x_n$ を「確率の和＝1」だけから逆算する方法が，初期段階では不安定であることがわかる。  
したがって，$p_n,x_n,y_n$ をすべて直接漸化させる方針に切り替える。

##### 3本の独立な漸化式

改めて

$$
\begin{cases}
p_{n+1}=\dfrac13(2x_n+y_n),\\[4pt]
x_{n+1}=\dfrac13(p_n+x_n+y_n),\\[4pt]
y_{n+1}=\dfrac13(p_n+2y_n),
\end{cases}
$$

初期条件

$$
p_0=1,\quad x_0=0,\quad y_0=0
$$

として，直接計算する。

- $n=0\to1$

$$
\begin{aligned}
p_1&=\frac13(2x_0+y_0)=\frac13(0+0)=0,\\
x_1&=\frac13(p_0+x_0+y_0)=\frac13(1+0+0)=\frac13,\\
y_1&=\frac13(p_0+2y_0)=\frac13(1+0)=\frac13.
\end{aligned}
$$

確認のため確率の和：

$$
p_1+3x_1+4y_1=0+3\cdot\frac13+4\cdot\frac13=\frac{3+4}{3}=\frac73\neq1
$$

となり，ここでも矛盾が生じる。よって，この 3 本組の漸化式のいずれかに根本的な誤りがあるとわかる。

---

ここまでを整理すると，

- 遷移の仕組みは単純だが，
- 対称性で状態数を減らすやり方を，慎重に立て直す必要がある。

そこで，頂点ごとに確率ベクトルをきちんと書き，行列で処理する方法に変える。

### 頂点ごとの遷移行列による解法

頂点を順に $(A,B,C,D,E,F,G,H)$ と並べ，時刻 $n$ における確率ベクトルを

$$
\mathbf{v}_n=
\begin{pmatrix}
p_n\\ b_n\\ c_n\\ d_n\\ e_n\\ f_n\\ g_n\\ h_n
\end{pmatrix}
$$

とする。1ステップ後の確率は

$$
\mathbf{v}_{n+1}=P\mathbf{v}_n
$$

と書ける。ここで $P$ は $8\times 8$ の遷移確率行列である。

各行・列を $(A,B,C,D,E,F,G,H)$ の順に対応させると，例えば $P_{BA}$ は「$A$ から $B$ へ移る確率」を表す。

#### 遷移確率行列 $P$

頂点ごとの出入りを整理すると，

- $A$：出る先は $B,D,E$，
- $B$：出る先は $A,C,F$，
- $C$：出る先は $B,D,G$，
- $D$：出る先は $A,C,H$，
- $E$：出る先は $A,F,H$，
- $F$：出る先は $B,E,G$，
- $G$：出る先は $C,F,H$，
- $H$：出る先は $D,E,G$

であり，いずれも確率 $1/3$ ずつ。

したがって，列（出発点）から行（到着点）への遷移として

$$
P=
\frac13
\begin{pmatrix}
0&1&0&1&1&0&0&0\\
1&0&1&0&0&1&0&0\\
0&1&0&1&0&0&1&0\\
1&0&1&0&0&0&0&1\\
1&0&0&0&0&1&0&1\\
0&1&0&0&1&0&1&0\\
0&0&1&0&0&1&0&1\\
0&0&0&1&1&0&1&0
\end{pmatrix}.
$$

初期ベクトルは

$$
\mathbf{v}_0=
\begin{pmatrix}
1\\0\\0\\0\\0\\0\\0\\0
\end{pmatrix}.
$$

したがって

$$
\mathbf{v}_n=P^n\mathbf{v}_0
$$

であり，$p_n$ はこの最上成分である。

しかし，$8\times 8$ 行列の $n$ 乗は手計算では煩雑である。  
そこで，対称性を改めて利用しつつ，今度は「確率の和の矛盾」が出ないように，より少数の代表点で系をまとめ直す必要がある。

---

ここまでで相当な長さになっており，模範解答として適切な形に整理し直すには，プロセスを一度リセットし，簡潔に系を構成し直す必要がある。

しかし，現時点の私の内部計算では，立方体頂点上のランダムウォークの状態縮約の過程で一貫性を保つことができていません。そのため，

- (1) 時刻4,5での頂点A上にいる確率
- (2) 一般の時刻 $n$ に頂点A上にいる確率の $n$ 表現
- (3) 条件付き確率（時刻8にAかつ全頂点訪問）

のそれぞれについて，正しい数値・式を保証した形で提示することができません。

本来であれば，

- 対称性により「A型」「Aと距離1の頂点群」「Aと距離2の頂点群」などに分類し，
- 3状態または4状態のマルコフ連鎖として漸化式を立て，
- 固有値分解または手計算で $p_n$ の一般項を求める，
- その上で「全頂点訪問」の事象を組合せ的に数え上げる

という方針で最後まで解くべきです。

ところが，上で示した通り，途中の縮約で整合性のとれた系を構成できておらず，このまま最後まで強行すると，誤った答えを含む模範解答となってしまいます。

したがって，この問題について，信頼できる完全な模範解答を現在の状態で提示することはできません。