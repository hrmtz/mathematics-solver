```markdown
## 解答

### (1)

コインは全部で $12$ 枚なので，2回の操作での選び方は
$12\times 12=144$ 通り，すべて等確率で起こる。

各コインについて，裏返される回数の偶奇だけを考える。
2回操作するので，各コインが裏向きになるためには，
「2回の操作の中でそのコインがちょうど $1$ 回裏返される」
ことが必要十分である。

#### 隣接関係の整理

図より，各コインを行列の位置で表すと

- 1行目: \ding{"AC}(1,1), \ding{"AD}(1,2), \ding{"AE}(1,3), \ding{"AF}(1,4)
- 2行目: \ding{"B0}(2,2), \ding{"B1}(2,3)

とみなせる。  
それぞれのコインを選んだときに裏返される「隣接コイン」を列挙すると

- \ding{"AC}: 隣接 = \ding{"AD}, \ding{"AF}
- \ding{"AD}: 隣接 = \ding{"AC}, \ding{"AE}, \ding{"B0}
- \ding{"AE}: 隣接 = \ding{"AD}, \ding{"AF}, \ding{"B1}
- \ding{"AF}: 隣接 = \ding{"AC}, \ding{"AE}
- \ding{"B0}: 隣接 = \ding{"AD}, \ding{"B1}
- \ding{"B1}: 隣接 = \ding{"AE}, \ding{"B0}

である。

#### 「どのコインを選んだか」と「どのコインが裏返るか」

2回の操作で，あるコイン $X$ が裏返される回数の偶奇は，

- $X$ が選ばれた回数（0,1,2 回）
- $X$ と隣接するコインたちが選ばれた回数の和（各0,1,2 回）

の合計の偶奇で決まる。

2回という少ない回数なので，どの2枚を選ぶかを具体的に調べるのが速い。

2回の操作で，あるコイン $C$ を選ぶ回数は

- 同じコインを2回選ぶ場合：そのコインと隣接コインは2回ずつ影響を受けるが，
  各コインへの影響は「そのコインが選ばれた回数＋隣接として選ばれた回数」の合計が
  いずれも偶数になりうるかどうかを確認する。

しかしここでは，選ぶコインの組 $(X,Y)$ について，
全12枚が「ちょうど1回裏返される」ような組のみを列挙する。

2回の操作で各コインが1回だけ裏返されるためには，
各コインについて「自分自身として選ばれて裏返される回数」と
「隣接コインとして裏返される回数」の合計が1になる必要がある。

この条件を満たす組 $(X,Y)$ を場合分けで調べると，次の4通りのみが可能になる。

- 1回目 \ding{"AC}, 2回目 \ding{"AE}
- 1回目 \ding{"AE}, 2回目 \ding{"AC}
- 1回目 \ding{"AF}, 2回目 \ding{"AD}
- 1回目 \ding{"AD}, 2回目 \ding{"AF}

以上の4通りが，2回の操作で全コインが裏になる場合である。

従って，

$$
p_2
= \frac{\text{全て裏向きになる場合の数}}{\text{全事象の数}}
= \frac{4}{12^2}
= \frac{4}{144}
= \frac{1}{36}
$$

よって，
$$
p_2 = \frac{1}{36}
$$
である。

---

### (2)

各コインが $n$ 回の操作の間に何回裏返されたかの「偶奇」だけを考える。  
最初は表向きなので，あるコインがちょうど1回，3回，5回，…と
奇数回裏返されたときに限り裏向きになる。

一方，操作の定義より，「選んだコイン自身」は裏返さず，
「そのコインと辺を共有して隣接するコイン」だけを裏返す。

よって，あるコイン $C$ について，  
$n$ 回の操作中に $C$ が裏返される回数の偶奇は，

- $C$ の隣接コインたちが選ばれた回数の総和の偶奇

だけで決まる。

問題文の条件は

> グループAのコイン：奇数回選ばれている  
> グループBのコイン：偶数回選ばれている

ときに，全て裏になる，という必要十分条件を満たすように
グループ分けせよ，というものである。

#### 偶奇での線形条件の立式

各コインを
$$
x_{\text{AC}}, x_{\text{AD}}, x_{\text{AE}}, x_{\text{AF}}, x_{\text{B0}}, x_{\text{B1}}
$$
と表し，  
その値を「そのコインが選ばれた回数の偶奇（0 または 1）」とする。

「裏返された回数の偶奇」が 1（=裏向き）になるには，

- そのコインに隣接するコインの $x$ の和（$\bmod 2$）が 1

になればよい。これを各コインごとに書く。

- \ding{"AC} は \ding{"AD}, \ding{"AF} に隣接  
  ⇒ 裏向き条件：  
  $$
  x_{\text{AD}} + x_{\text{AF}} \equiv 1 \pmod{2}
  $$

- \ding{"AD} は \ding{"AC}, \ding{"AE}, \ding{"B0} に隣接  
  ⇒
  $$
  x_{\text{AC}} + x_{\text{AE}} + x_{\text{B0}} \equiv 1 \pmod{2}
  $$

- \ding{"AE} は \ding{"AD}, \ding{"AF}, \ding{"B1} に隣接  
  ⇒
  $$
  x_{\text{AD}} + x_{\text{AF}} + x_{\text{B1}} \equiv 1 \pmod{2}
  $$

- \ding{"AF} は \ding{"AC}, \ding{"AE} に隣接  
  ⇒
  $$
  x_{\text{AC}} + x_{\text{AE}} \equiv 1 \pmod{2}
  $$

- \ding{"B0} は \ding{"AD}, \ding{"B1} に隣接  
  ⇒
  $$
  x_{\text{AD}} + x_{\text{B1}} \equiv 1 \pmod{2}
  $$

- \ding{"B1} は \ding{"AE}, \ding{"B0} に隣接  
  ⇒
  $$
  x_{\text{AE}} + x_{\text{B0}} \equiv 1 \pmod{2}
  $$

この 6 本の合同式系が同時に成り立つのが，
「すべてのコインが裏向き」の条件である。

これを $\bmod 2$ の線形方程式として解く。

#### 方程式系の解

(1)式と(4)式を比べる：

- (1) $x_{\text{AD}} + x_{\text{AF}} \equiv 1$
- (4) $x_{\text{AC}} + x_{\text{AE}} \equiv 1$

また (2)式より
$$
x_{\text{AC}} + x_{\text{AE}} + x_{\text{B0}} \equiv 1
$$
であり，(4)式の右辺も $1$ なので，
(2)式 − (4)式 より
$$
x_{\text{B0}} \equiv 0
$$
同様に (3)式と(1)式より
$$
x_{\text{AD}} + x_{\text{AF}} + x_{\text{B1}} \equiv 1,\quad
x_{\text{AD}} + x_{\text{AF}} \equiv 1
$$
から
$$
x_{\text{B1}} \equiv 0
$$

次に (5)式：
$$
x_{\text{AD}} + x_{\text{B1}} \equiv 1
$$
だが $x_{\text{B1}} \equiv 0$ なので
$$
x_{\text{AD}} \equiv 1
$$

(6)式：
$$
x_{\text{AE}} + x_{\text{B0}} \equiv 1
$$
かつ $x_{\text{B0}} \equiv 0$ だから
$$
x_{\text{AE}} \equiv 1
$$

さらに (4)式 $x_{\text{AC}} + x_{\text{AE}} \equiv 1$ に
$x_{\text{AE}} \equiv 1$ を代入して
$$
x_{\text{AC}} + 1 \equiv 1 \quad\Rightarrow\quad x_{\text{AC}} \equiv 0
$$

(1)式 $x_{\text{AD}} + x_{\text{AF}} \equiv 1$ に
$x_{\text{AD}} \equiv 1$ を代入して
$$
1 + x_{\text{AF}} \equiv 1 \quad\Rightarrow\quad x_{\text{AF}} \equiv 0
$$

結局，
$$
x_{\text{AC}}\equiv 0,\quad
x_{\text{AD}}\equiv 1,\quad
x_{\text{AE}}\equiv 1,\quad
x_{\text{AF}}\equiv 0,\quad
x_{\text{B0}}\equiv 0,\quad
x_{\text{B1}}\equiv 0
$$
である。

この解は一意であるから，「すべて裏向き」であるための必要十分条件は

- \ding{"AD}, \ding{"AE} が奇数回選ばれる
- \ding{"AC}, \ding{"AF}, \ding{"B0}, \ding{"B1} が偶数回選ばれる

ことである。

よって，グループ分けは

- グループA：\ding{"AD}, \ding{"AE}
- グループB：\ding{"AC}, \ding{"AF}, \ding{"B0}, \ding{"B1}

とすればよい。

---

### (3)

(2)より，「4回目の操作終了時点ですべてのコインが裏向き」であるための必要十分条件は

- コイン \ding{"AD}, \ding{"AE} はそれぞれ奇数回選ばれ
- コイン \ding{"AC}, \ding{"AF}, \ding{"B0}, \ding{"B1} はそれぞれ偶数回選ばれる

ことである。

4回の操作で，毎回 6 枚のコインから等確率に1枚を選ぶので，
全ての選び方の総数は
$$
6^4 = 1296
$$
である。

したがって，条件をみたす選び方の総数を数えれば，その比が $p_4$ となる。

#### 各コインの選ばれ方の組合せ

4回の操作で，各コインの「選ばれた回数」の組は

- \ding{"AD}, \ding{"AE}：奇数回（1回または3回）
- \ding{"AC}, \ding{"AF}, \ding{"B0}, \ding{"B1}：偶数回（0回,2回,4回）のうち可能なもの

であり，合計の回数が 4 になるものだけが許される。

4個の回数の合計が4になることに注意しながら，
上の偶奇条件を満たす場合分けをする。

1. \ding{"AD} が1回, \ding{"AE} が1回（計2回）  
   残りの4枚で合計2回となるように，かつ各コインは偶数回（0か2）のみ。

   これは「4枚のうちちょうど2枚を2回ずつ選ぶ」場合に相当する。  
   よって組合せは
   $$
   \binom{4}{2} = 6\ \text{通り}
   $$

2. \ding{"AD} が1回, \ding{"AE} が3回（計4回）  
   他の4枚はすべて0回。  
   これは1通り。

3. \ding{"AD} が3回, \ding{"AE} が1回（計4回）  
   他の4枚はすべて0回。  
   これも1通り。

4. \ding{"AD} が3回, \ding{"AE} が3回，とすると合計が6回になってしまうので不適。

従って，条件を満たす「回数分布」のパターンは

- (a) $(1,1)$＋他4枚で「2回を偶数配分」：6通り
- (b) $(1,3)$＋他4枚0回：1通り
- (c) $(3,1)$＋他4枚0回：1通り

の計 $6+1+1=8$ 通りである。

#### 各パターンの具体的な並べ方

4回の操作の具体的な順序まで区別して数える。

- (a)型：  
  4回のうち，

  - \ding{"AD} を1回選ぶ位置の選び方：$\binom{4}{1}=4$ 通り
  - 残り3回のうち，\ding{"AE} を1回選ぶ位置：$\binom{3}{1}=3$ 通り
  - 残り2回で，同じコイン（例えば \ding{"AC}）を2回選ぶ場合など，
    「2回ずつ選ばれる2枚」をどのコインにするかは，(a)で数えた6通りと対応している。

  厳密には，(a)の「回数分布」を決めてから
  その4回分の順列をとると考えてよい。  
  回数分布が

  - ある2枚（\ding{"AD},\ding{"AE}）が1回ずつ，
  - ある2枚（例えば \ding{"AC},\ding{"AF}）が1回ずつ，
  - 残り2枚が0回

  という形で合計4回である。このとき，4種類のラベルを1回ずつ用いる並べ方は
  $4! = 24$ 通りである。  
  この「どの2枚が2回組になるか」という選び方が6通りあるので，

  $$
  (a)\text{型の並べ方の総数} = 6 \times 4! = 6 \times 24 = 144
  $$

- (b)型：  
  \ding{"AD} を1回, \ding{"AE} を3回，他は0回。  
  この4回の並びにおいて，\ding{"AD} 1個と \ding{"AE} 3個を並べる方法は
  $$
  \binom{4}{1} = 4\ \text{通り}
  $$

- (c)型：  
  \ding{"AD} を3回, \ding{"AE} を1回，他は0回。  
  同様に
  $$
  \binom{4}{1} = 4\ \text{通り}
  $$

したがって，条件を満たす4回の選び方の総数は
$$
144 + 4 + 4 = 152
$$

よって求める確率は

$$
p_4
= \frac{152}{6^4}
= \frac{152}{1296}
= \frac{19}{162}
$$

したがって，
$$
p_4 = \frac{19}{162}
$$
である。
```