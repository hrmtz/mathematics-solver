## 解答

(1)  
初めは $n$ 枚すべてが金貨である。1回目の試行では，各金貨は表か裏のどちらかで出るから，  
「裏が出た金貨の枚数」を $r$ 枚とすると，これは二項分布に従い，その確率は  
$$
\binom{n}{r}\left(\frac12\right)^n
$$
である。裏が出た金貨 $r$ 枚を取り去り，同数の銀貨 $r$ 枚を加えるので，金貨の枚数は $n-r$ 枚となる。  
したがって，1回目の試行直後に金貨が $j$ 枚であるのは $n-r = j$，すなわち $r = n-j$ のときであり，その確率は

$$
P_1(j)
= \binom{n}{n-j}\left(\frac12\right)^n
= \binom{n}{j}\left(\frac12\right)^n
\quad(0\leqq j \leqq n)
$$

である。

---

(2)  
$k\geqq2$ とする。$k$ 回目の試行直後に金貨が $j$ 枚である確率 $P_k(j)$ を求める。

この試行では，各回ごとに  
- 「前の回の試行直後に金貨が何枚あったか」だけが次の分布に影響し，  
- そのとき存在する金貨は，それぞれ独立に確率 $1/2$ で表・裏が出る

という性質がある。これは条件付き分布が「そのとき存在している金貨に対する二項分布」になることを意味する。

実際に，$k-1$ 回目の試行直後に金貨が $i$ 枚であったとする。この状態から $k$ 回目の試行を行うとき，
その $i$ 枚の金貨を同時に投げる。裏が出た金貨の枚数を $r$ とすると，その確率は

$$
\binom{i}{r}\left(\frac12\right)^i
$$

である。裏が出た $r$ 枚を取り去り，同数の銀貨を加えるから，金貨の枚数は $i-r$ 枚となる。

したがって，$k$ 回目の試行直後に金貨が $j$ 枚となるためには $i-r = j$，すなわち $r = i-j$ が必要である。  
このとき

$$
0 \leq r = i-j \leq i
\quad\Longleftrightarrow\quad
j \leq i \leq n
$$

が成り立つ。以上より，「$k-1$ 回目に金貨が $i$ 枚」である条件のもとで，「$k$ 回目直後に金貨が $j$ 枚」となる条件付き確率は

$$
\Pr(\text{$k$ 回目直後に金貨が $j$ 枚}\mid \text{$k-1$ 回目直後に金貨が $i$ 枚})
=
\begin{cases}
\displaystyle \binom{i}{i-j}\left(\dfrac12\right)^i
= \binom{i}{j}\left(\dfrac12\right)^i & (0\leq j \leq i),\\[6pt]
0 & (j>i).
\end{cases}
$$

ゆえに，全確率の法則より

$$
P_k(j)
= \sum_{i=0}^n
\Pr(\text{$k$ 回目直後に金貨が $j$ 枚} \mid \text{$k-1$ 回目直後に金貨が $i$ 枚})
\cdot P_{k-1}(i)
$$

であるから，上の条件付き確率の式を用いると

$$
P_k(j)
= \sum_{i=j}^n \binom{i}{j}\left(\frac12\right)^i P_{k-1}(i)
\quad(k\geqq 2,\ 0\leqq j\leqq n)
$$

となる。

---

(3)  
$n=3$ とする。求めるのは，

「2回目の試行の直後では金貨が少なくとも1枚残り，3回目の試行の直後には3枚すべてが銀貨になる」

という事象の確率である。これは

- 2回目直後に金貨が $1$ 枚，かつ 3回目直後に金貨が $0$ 枚  
または  
- 2回目直後に金貨が $2$ 枚，かつ 3回目直後に金貨が $0$ 枚  
または  
- 2回目直後に金貨が $3$ 枚，かつ 3回目直後に金貨が $0$ 枚  

となる場合の和である。よって，これらの確率を順に計算して足し合わせればよい。

まず，(1) で求めた式に $n=3$ を代入すると

$$
P_1(j) = \binom{3}{j}\left(\frac12\right)^3
\quad(j=0,1,2,3)
$$

である。したがって

$$
P_1(0)=\frac{1}{8},\quad
P_1(1)=\frac{3}{8},\quad
P_1(2)=\frac{3}{8},\quad
P_1(3)=\frac{1}{8}
$$

となる。

次に，(2) の一般式に $n=3,\ k=2$ を代入して $P_2(j)$ を求める。

$$
P_2(j)
= \sum_{i=j}^{3} \binom{i}{j}\left(\frac12\right)^i P_1(i)
\quad(j=0,1,2,3).
$$

順に計算すると，

- $j=0$ のとき
  $$
  P_2(0)
  = \sum_{i=0}^{3} \binom{i}{0}\left(\frac12\right)^i P_1(i)
  = \sum_{i=0}^{3} \left(\frac12\right)^i P_1(i)
  $$
  であり，
  $$
  \begin{aligned}
  P_2(0)
  &= \left(\frac12\right)^0\cdot\frac18
   + \left(\frac12\right)^1\cdot\frac38
   + \left(\frac12\right)^2\cdot\frac38
   + \left(\frac12\right)^3\cdot\frac18\\
  &= \frac18 + \frac{3}{16} + \frac{3}{32} + \frac{1}{64}\\
  &= \frac{8+12+6+1}{64} = \frac{27}{64}
  \end{aligned}
  $$

- $j=1$ のとき
  $$
  P_2(1)
  = \sum_{i=1}^{3} \binom{i}{1}\left(\frac12\right)^i P_1(i)
  = \sum_{i=1}^{3} i\left(\frac12\right)^i P_1(i)
  $$
  であり，
  $$
  \begin{aligned}
  P_2(1)
  &= 1\cdot\left(\frac12\right)^1\cdot\frac38
   + 2\cdot\left(\frac12\right)^2\cdot\frac38
   + 3\cdot\left(\frac12\right)^3\cdot\frac18\\
  &= \frac{3}{16} + \frac{3}{16} + \frac{3}{64}\\
  &= \frac{12+12+3}{64} = \frac{27}{64}
  \end{aligned}
  $$

- $j=2$ のとき
  $$
  P_2(2)
  = \sum_{i=2}^{3} \binom{i}{2}\left(\frac12\right)^i P_1(i)
  $$
  であり，
  $$
  \begin{aligned}
  P_2(2)
  &= \binom{2}{2}\left(\frac12\right)^2\cdot\frac38
   + \binom{3}{2}\left(\frac12\right)^3\cdot\frac18\\
  &= 1\cdot\frac{1}{4}\cdot\frac{3}{8}
   + 3\cdot\frac{1}{8}\cdot\frac{1}{8}\\
  &= \frac{3}{32} + \frac{3}{64}\\
  &= \frac{6+3}{64} = \frac{9}{64}
  \end{aligned}
  $$

- $j=3$ のとき
  $$
  P_2(3)
  = \sum_{i=3}^{3} \binom{3}{3}\left(\frac12\right)^3 P_1(3)
  = 1\cdot\frac{1}{8}\cdot\frac{1}{8}
  = \frac{1}{64}
  $$

以上より，

$$
P_2(0)=\frac{27}{64},\quad
P_2(1)=\frac{27}{64},\quad
P_2(2)=\frac{9}{64},\quad
P_2(3)=\frac{1}{64}
$$

である。

次に，3回目で金貨が $0$ 枚になる確率を求める。  
「2回目直後に金貨が $i$ 枚」である条件付きで，3回目直後に金貨が $0$ 枚になるのは，$i$ 枚すべてが裏を向くときであり，その確率は

$$
\left(\frac12\right)^i
$$

である（各金貨は独立に表裏をとり，裏が出たものはすべて取り去られるため）。

したがって，「2回目直後に金貨が $i$ 枚，かつ 3回目直後に金貨が $0$ 枚」となる確率は

$$
P_2(i)\cdot\left(\frac12\right)^i
$$

である。ここで問題文の条件「2回目の試行直後では金貨が少なくとも1枚残る」から，$i=1,2,3$ の場合を合計すればよい。よって求める確率は

$$
\sum_{i=1}^{3} P_2(i)\left(\frac12\right)^i
= P_2(1)\cdot\frac12 + P_2(2)\cdot\frac14 + P_2(3)\cdot\frac18
$$

であり，これに上で求めた値を代入すると，

$$
\begin{aligned}
\text{求める確率}
&= \frac{27}{64}\cdot\frac12 + \frac{9}{64}\cdot\frac14 + \frac{1}{64}\cdot\frac18\\
&= \frac{27}{128} + \frac{9}{256} + \frac{1}{512}\\
&= \frac{108+18+1}{512}
= \frac{127}{512}
\end{aligned}
$$

となる。

したがって，求める確率は

$$
\frac{127}{512}
$$

である。