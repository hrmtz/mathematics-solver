## 解答

(1)  
分数 $\dfrac{p}{q}$ が既約であるとは，$\gcd(p,q)=1$ であることと定義する．  
樹形図の最上段には $\dfrac{1}{1}$ があり，これは明らかに既約分数である．

規則より，$\dfrac{p}{q}$ の左下の分数は $\dfrac{p}{p+q}$，右下の分数は $\dfrac{p+q}{q}$ である．

$\dfrac{p}{q}$ が既約である，つまり $\gcd(p,q)=1$ であると仮定する．  
このとき，$\gcd(p,p+q)$ と $\gcd(p+q,q)$ を調べる．

まず，$d=\gcd(p,p+q)$ とおくと，$d\mid p$ かつ $d\mid(p+q)$ だから，  
$d\mid(p+q-p)=q$ も成り立つ．したがって $d$ は $p$ と $q$ の公約数である．  
ところが $\gcd(p,q)=1$ であるから，$d=1$ である．  
ゆえに  
$$
\gcd(p,p+q)=1
$$
となり，$\dfrac{p}{p+q}$ は既約分数である．

同様にして，$e=\gcd(p+q,q)$ とおくと，$e\mid (p+q)$ かつ $e\mid q$ より  
$e\mid (p+q-q)=p$ も成り立つ．したがって $e$ は $p$ と $q$ の公約数だから，  
$\gcd(p,q)=1$ より $e=1$ である．  
よって  
$$
\gcd(p+q,q)=1
$$
であり，$\dfrac{p+q}{q}$ も既約分数である．

以上より，既約分数から出発すると，その左右の子も既約分数になる．  
最上段の $\dfrac{1}{1}$ が既約であることと合わせて，  
数学的帰納法により，この樹形図に現れる分数はすべて既約分数である．  
（題意より $\dfrac{n}{1}$ も既約分数とみなされる．）

---

(2)  
任意の正の有理数が樹形図に現れることを示す．  
(1) より，この樹に現れる分数はすべて既約分数であるから，  
「正の有理数」についても，既約分数 $\dfrac{p}{q}$（$p,q$ は正の整数，$\gcd(p,q)=1$）としてよい．

樹形図の生成規則は  
$$
\frac{p}{q}
\quad\longrightarrow\quad
\frac{p}{p+q},\ \frac{p+q}{q}
$$
である．  
これを逆向きにたどることを考える．

任意の既約分数 $\dfrac{p}{q}$ をとる．  
この分数がある段に現れていると仮定すると，その「親」に当たる分数を次のように一意的に決めることができる：

- $p>q$ のとき：  
  $\dfrac{p}{q}$ は右の子の形 $\dfrac{p+q}{q}$ から来たとみなせる．  
  すなわち，$p+q=p$ かつ $q=q$ となる親分数は $\dfrac{p-q}{q}$ である．  
  このとき $\gcd(p,q)=1$ ならば，$\gcd(p-q,q)=1$ であることは (1) と同様の議論でわかる．  
  よって $\dfrac{p-q}{q}$ も既約であり，親として適切である．

- $p<q$ のとき：  
  $\dfrac{p}{q}$ は左の子の形 $\dfrac{p}{p+q}$ から来たとみなせる．  
  すなわち，$p=p$ かつ $p+q=q$ となる親分数は $\dfrac{p}{q-p}$ である．  
  同様の理由で，$\gcd(p,q)=1$ ならば $\gcd(p,q-p)=1$ となり，$\dfrac{p}{q-p}$ も既約である．

- $p=q$ のときは $\dfrac{p}{q}=\dfrac{1}{1}$ となるしかないが，  
  樹の根が $\dfrac{1}{1}$ であることから，この場合は根に到達したとみなす．

ここで，$p\neq q$ のとき上の手続きを行うと，分子と分母の和 $p+q$ は

- $p>q$ のとき：親は $\dfrac{p-q}{q}$ であり，和は $(p-q)+q=p$，  
- $p<q$ のとき：親は $\dfrac{p}{q-p}$ であり，和は $p+(q-p)=q$，

となるので，必ず $p+q$ より小さくなる．

したがって，既約分数 $\dfrac{p}{q}$ から始めて，  
$(p,q)\mapsto (p-q,q)$ または $(p,q-p)$ という操作を繰り返すと，  
分子と分母の和は正の整数として単調に減少していくから，有限回で $p=q$ に到達する．  
$p=q$ となったときの分数は $\dfrac{1}{1}$ であり，これは樹の根である．  

この過程を逆にたどると，$\dfrac{1}{1}$ からスタートして  
左右の子を選びながら進むことで，もとの $\dfrac{p}{q}$ に到達する道が存在することになる．  

よって，任意の正の既約分数 $\dfrac{p}{q}$ はこの樹形図上のどこかに現れる．  
したがって，すべての正の有理数がこの樹形図に現れる．

---

(3)  
樹形図に現れる有理数はすべて異なることを示す．  
(2) で用いた「逆向きに親にさかのぼる手続き」が，  
任意の既約分数に対して 1 通りに定まることを利用する．

(2) で述べたように，既約分数 $\dfrac{p}{q}$（$p,q>0$）に対し，

- $p>q$ なら親は $\dfrac{p-q}{q}$，
- $p<q$ なら親は $\dfrac{p}{q-p}$，
- $p=q$ なら $\dfrac{1}{1}$（根）

と一意に定まる．  
この対応は，いずれの場合も和 $p+q$ を必ず減少させるので，  
有限回で必ず $\dfrac{1}{1}$ に到達し，途中でループは起こらない．

したがって，樹の中の任意の分数から根 $\dfrac{1}{1}$ へさかのぼる道は 1 通りである．  
言い換えると，任意の分数に対応する「根からそこに至るまでの左右の選び方の列」が一意に決まる．

もし，ある分数 $\dfrac{p}{q}$ が樹形図の 2 箇所以上に現れると仮定すると，  
根からその 2 箇所まで行くための道は異なるので，  
$\dfrac{p}{q}$ から根へさかのぼる道も 2 通り以上存在することになる．  
しかしこれは，上で示した「親へのさかのぼり方は一意である」という事実に反する．  

ゆえに，この樹形図に現れる有理数はすべて互いに異なる．

---

(4)  
$\dfrac{19}{44}$ がこの樹形図の上から何段目の左から何番目かを求める．  

(2) で用いた親へのさかのぼり手続きを，$\dfrac{19}{44}$ に対して実行する．  
まず $\gcd(19,44)=1$ だから，この分数は既約分数であり，樹形図に出現することは (2) から保証されている．

$\dfrac{19}{44}$ について $19<44$ なので，左の子から来たと考える．  
したがって親は  
$$
\frac{19}{44-19}=\frac{19}{25}
$$
であり，現在の分数 $\dfrac{19}{44}$ は「左の子（L）」と記録しておく．

同様に，$\dfrac{19}{25}$ では $19<25$ なので親は  
$$
\frac{19}{25-19}=\frac{19}{6}
$$
このときも「左の子（L）」である．

次に $\dfrac{19}{6}$ については $19>6$ なので，右の子から来たと考える．  
よって親は  
$$
\frac{19-6}{6}=\frac{13}{6}
$$
であり，このときは「右の子（R）」と記録する．

さらに $\dfrac{13}{6}$ も $13>6$ なので親は  
$$
\frac{13-6}{6}=\frac{7}{6}
$$
であり，これも「右の子（R）」である．

同様に $\dfrac{7}{6}$ は $7>6$ だから親は  
$$
\frac{7-6}{6}=\frac{1}{6}
$$
であり，「右の子（R）」．

最後に $\dfrac{1}{6}$ では $1<6$ なので親は  
$$
\frac{1}{6-1}=\frac{1}{5}
$$
であり，「左の子（L）」となる．

続けると，  
$\dfrac{1}{5}$ から親は $\dfrac{1}{4}$（L），  
$\dfrac{1}{4}$ から親は $\dfrac{1}{3}$（L），  
$\dfrac{1}{3}$ から親は $\dfrac{1}{2}$（L），  
$\dfrac{1}{2}$ から親は $\dfrac{1}{1}$（L）  
となる．

以上をまとめると，$\dfrac{1}{1}$ から $\dfrac{19}{44}$ までの進み方は，  
親をさかのぼったときに記録した L,R を逆向きに読めばよいので，

- $\dfrac{1}{1}$ から 左(L) に進んで $\dfrac{1}{2}$，
- 左(L) に進んで $\dfrac{1}{3}$，
- 左(L) に進んで $\dfrac{1}{4}$，
- 左(L) に進んで $\dfrac{1}{5}$，
- 左(L) に進んで $\dfrac{1}{6}$，
- 右(R) に進んで $\dfrac{7}{6}$，
- 右(R) に進んで $\dfrac{13}{6}$，
- 右(R) に進んで $\dfrac{19}{6}$，
- 左(L) に進んで $\dfrac{19}{25}$，
- 左(L) に進んで $\dfrac{19}{44}$，

という経路になる．  
記号列で書くと  
$$
\text{L L L L L R R R L L}
$$
である．

ここで，樹形図の段数を数えるとき，最上段の $\dfrac{1}{1}$ を「1段目」とし，  
その1つ下の $\dfrac{1}{2},\dfrac{2}{1}$ が「2段目」，  
さらにその下が「3段目」…と数える．  
根から 1 回進むと 2 段目，2 回進むと 3 段目，…となるから，  
進む回数が $k$ 回であれば $k+1$ 段目である．

今回，$\dfrac{1}{1}$ から $\dfrac{19}{44}$ までは左・右の移動を合計 $10$ 回行っているので，  
$\dfrac{19}{44}$ は上から $10+1=11$ 段目にある．  

次に，11 段目の左から何番目かを調べる．  
ある段での「左からの番号」は，同じ段の中で左から順に 1,2,3,… と番号をつけたときの順序である．  
ここで重要なのは，

- その段で左の子は父のいる位置をそのまま「継ぐ」，
- 右の子は，その段で父より右側にあるすべての子の後ろに並ぶ，

という構造になっているように見えるが，  
この樹形図（問題文中の図）では，各段の分数は左から順に「根からの L,R 列を二進数的に読む順」に並び，  
同じ段での左からの順は，  
根からそこまでの L,R の列を，L を 0，R を 1 とみなして並べた順と一致していることがわかる．

したがって，その段の左からの番号は，  
「その段に属するノードのうち，根からそこまでの L,R 列を辞書式順序（ L<R として ）に並べたときの順番」  
と一致する．

ここで，11 段目の各分数に対応する L,R 列は，長さ 10 の L,R 列すべてである．  
$\dfrac{19}{44}$ に対応する列は  
$$
\text{L L L L L R R R L L}
$$
である．  

L を 0，R を 1 とみなして 2 進数として読めば，  
$$
\text{L L L L L R R R L L}
\quad\leftrightarrow\quad
0\,0\,0\,0\,0\,1\,1\,1\,0\,0
$$
となり，これを 2 進法の整数とみなせば  
$$
0\cdot 2^9 + 0\cdot 2^8 + 0\cdot 2^7 + 0\cdot 2^6 + 0\cdot 2^5
+ 1\cdot 2^4 + 1\cdot 2^3 + 1\cdot 2^2 + 0\cdot 2^1 + 0\cdot 2^0
= 16+8+4=28
$$
となる．  

2 進数の $00000\,11100$ は 10 進で 28 であるから，  
長さ 10 の L,R 列の中で，  
辞書式順序（先頭から L を 0，R を 1 として比較）で並べたとき，  
この列は「0 から数えて 28 番目」に位置する．  

左から数えるときは 1 から始めるので，  
$$
\text{左からの番号} = 28+1 = 29
$$
となる．

以上より，$\dfrac{19}{44}$ は

- 上から 11 段目，
- 左から 29 番目

に配置される．