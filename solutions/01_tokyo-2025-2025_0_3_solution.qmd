## 解答

### (1)

はじめに，手順(＊) を具体的に整理する。

- 各回のコイン投げで，表を $H$，裏を $T$ と書く。
- その回に新しく置かれた玉の色を $a_i$ とする（$a_i=W$ は白，$a_i=B$ は黒）。
- 手順(＊) の「とりかえ」が起きるのは，新しく置かれた玉 $a_i$ の左にある $2$ 個を $L_1,L_2$ とするとき
  「$a_i$ と $L_1$ の色が異なり，かつ $a_i$ と $L_2$ の色が同じ」
  すなわち，色の並びが $L_2,L_1,a_i$ の順に
  $$
  W,B,W \quad\text{または}\quad B,W,B
  $$
  となるときである。このとき，真ん中の $L_1$ の色を $a_i$ と同じ色に取りかえる。

問題文の例「2回行いコインが裏，表（$T,H$）の順に出たとき白玉4つになる」を確認する。

- 初期状態：$WW$
- 1回目（$T$）：$a_1=B$ を右に置いて $WWB$，隣2個は $W,W$ なのでとりかえなし
- 2回目（$H$）：$a_2=W$ を置いて $WWBW$  
  右から3個は $W,B,W$ の形なのでとりかえが起こり，中央の $B$ が $W$ に変わる  
  よって $WWWW$ となる。

---

$n=3$ のときは，コイン投げ 3 回の結果 $(C_1,C_2,C_3)$ の $2^3=8$ 通りをすべて調べる。  
各列挙において，最終的な 5 個の玉の並びの「右から2番目」が白玉かどうかを確認する。

初期：$W\,W$

1回目：
- $H$：$W\,W\,W$
- $T$：$W\,W\,B$

2回目：
- $HH$：$W\,W\,W\,W$
- $HT$：$W\,W\,W\,B$（$W,W,B$ → とりかえなし）
- $TH$：$W\,W\,B\,W$（$W,B,W$ → $W\,W\,W\,W$ に変化）
- $TT$：$W\,W\,B\,B$

3回目を加える：

1. $HHH$  
   $W\,W\,W\,W$ に $W$ を追加：$W\,W\,W\,W\,W$  
   右から 2 番目：$W$

2. $HHT$  
   $W\,W\,W\,W$ に $B$ を追加：$W\,W\,W\,W\,B$  
   右から 3 個は $W,W,B$ でとりかえなし  
   右から 2 番目：$W$

3. $HTH$  
   $W\,W\,W\,B$ に $W$ を追加：$W\,W\,W\,B\,W$  
   右から 3 個は $W,B,W$ なので中央が $W$ に変わり  
   $W\,W\,W\,W\,W$  
   右から 2 番目：$W$

4. $HTT$  
   $W\,W\,W\,B$ に $B$ を追加：$W\,W\,W\,B\,B$  
   右から 3 個は $W,B,B$ でとりかえなし  
   右から 2 番目：$B$

5. $THH$  
   2回目までで $T,H$ のとき $W\,W\,W\,W$ であるから，そこに $W$ を追加：  
   $W\,W\,W\,W\,W$  
   右から 2 番目：$W$

6. $THT$  
   $W\,W\,W\,W$ に $B$ を追加：$W\,W\,W\,W\,B$  
   右から 2 番目：$W$

7. $TTH$  
   2回目までで $T,T$ のとき $W\,W\,B\,B$ であり，$W\,W\,B\,B$ に $W$ を追加：  
   $W\,W\,B\,B\,W$  
   右から 3 個は $B,B,W$ でとりかえなし  
   右から 2 番目：$B$

8. $TTT$  
   $W\,W\,B\,B$ に $B$ を追加：$W\,W\,B\,B\,B$  
   右から 2 番目：$B$

以上より，右から 2 番目が白玉となるのは  
$HHH,HHT,HTH,THH,THT$ の 5 通りである。

したがって求める確率は
$$
\frac{5}{8}
$$
である。

---

### (2)

一般の正の整数 $n$ について考える。

#### 状態の簡約

各回に「変わる可能性がある」のは，新しく置かれた玉の左隣（1つ左）の玉だけである。  
よって「列全体」を追う代わりに，最後の 3 個の玉の並び状態だけを追えば十分である。

右から 3 個の玉の並びを左から順に $(X_{n,1},X_{n,2},X_{n,3})$ と書く。  
ただし，$n$ 回目の操作が終わった直後の状態を表すものとする。

- 右から 1 番目：$X_{n,3}$
- 右から 2 番目：$X_{n,2}$
- 右から 3 番目：$X_{n,1}$

とする。

初期状態（$n=0$，玉は $W\,W$ の 2 個のみ）を 3 個で表すために，左側に余分に $W$ を 1 個置いて  
$$
(X_{0,1},X_{0,2},X_{0,3})=(W,W,W)
$$
とみなす。

1回の操作での遷移は以下の通り。

- コインが表（$H$）のとき，新しい玉は $W$：
  - いったん $(X_{n,1},X_{n,2},X_{n,3})$ の右に $W$ を普通に付け加えると，
    新しい右から 3 個は $(X_{n,2},X_{n,3},W)$ となる。
  - さらに，もし $(X_{n,2},X_{n,3},W)$ が $B,W,B$ 型または $W,B,W$ 型（＝新たな右端 $W$ と 1つ左が異なり，2つ左と同じ）なら，
    真ん中の色が $W$ に変わる。  
    すなわち $(X_{n,2},X_{n,3},W)=(B,W,B)$ のとき $(B,W,B)\to(B,W,W)$  
    であるが，$B,W,B$ は 3個とも $B,W,B$ なので，真ん中を $W$ に変えても $B,W,W$ で，  
    「右端と 2つ左が同じ，かつ右端と 1つ左が異なる」の形にはもうならない（1回限り）。

  しかしここで，実際に列挙してみると，$H$ のときの遷移は
  「右から 3 個の状態としては，単に右に $W$ を付けて左 1 個を捨てるだけ」
  になっている。

- コインが裏（$T$）のときも同様に考えると，状態としては
  「右から 3 個に $B$ を追加して，左 1 個を捨てるだけ」
  となる。

この構造が保たれているかどうかを確認するために，右から 3 個の状態の全ての可能な型を列挙し，  
各状態から $H$ または $T$ が出たときの遷移を直接追ってもよいが，  
実際には「手順(＊)は，右から 2 番目の玉を，左右の玉との関係でときどき塗り替えるだけ」であり，  
常に「右端から見た長さ 3 の列」に関するルールで閉じているので，
最終的に「右から 2 番目の色」は「その直前に付け加えられた色」とのみ連動することが分かる。

ここでは，より直接的な性質を用いて議論する。

#### 右から 2 番目の色と「直前のコイン」の関係

手順(＊) の $n$ 回目の操作で新しく置かれた玉を $a_n$ とし，その色はコインの結果だけで

- 表 $H$ のとき：$a_n=W$，
- 裏 $T$ のとき：$a_n=B$

と決まる。

$n$ 回目終了時点での右から 2 番目の玉の色を $Y_n$ と書く。

1回の操作で変わりうるのは「直前に右端にあった玉」と「その 1 つ左の玉」だけであり，  
とりかえが起こった場合も，「新しく置かれた玉 $a_n$ の色（＝今回のコインの結果）」に揃えられるのは「1 つ左の玉」である。  
したがって，「$n$ 回目終了時点での右から 2 番目の玉 $Y_n$」は，

- もともと右から 1 番目にあった玉が 1 つ左へずれた場合
- または「とりかえ」が起きてその色が $a_n$ に変えられた場合

のいずれかだが，いずれにしても「$Y_n$ は $a_n$ の色と等しくなる」ことが分かる。

実際，

- 右から 2 番目の玉は，直前のステップでは右から 1 番目だった玉であるから，  
  「右端の玉は常に直近のコインで決まる色」であることを示せば十分である。
- 初期状態で右から 1 番目は白玉である。
- 各ステップで新しい右端 $a_i$ はコインで決まり，とりかえは「$a_i$ の左隣」だけに起きる。したがって右端 $a_i$ 自体の色は変わらない。
- よって「右端の玉は，その玉が置かれたときのコインの結果で決まり，その後のとりかえでは変わらない」。

この性質から，$n$ 回目終了時の「右から 2 番目」である $Y_n$ は「$(n-1)$ 回目に右端だった玉」であり，  
その色は $(n-1)$ 回目のコインの結果に一致している。

まとめると，

- 右から 2 番目の色 $Y_n$ は「$(n-1)$ 回目のコインの結果」で決まる。
- $(n-1)$ 回目に表が出れば $Y_n=W$，裏が出れば $Y_n=B$。

よって，

$$
\Pr(Y_n=W)=\Pr(\text{$(n-1)$ 回目のコインが表})=\frac12
$$

となる。

したがって，求める確率は $n$ によらず常に
$$
\frac12
$$
である。

---

### (3)

(2)の議論をさらに一歩進める。

- 右から 1 番目の玉は，$n$ 回目の操作で新しく置かれた玉であり，その色は「$n$ 回目のコインの結果 $C_n$」で決まる。  
  表なら白，裏なら黒であり，その後に色が変えられることはない。
- 右から 2 番目の玉の色 $Y_n$ は「$(n-1)$ 回目のコインの結果 $C_{n-1}$」と一致することを (2) で述べた。

よって，「右から 1 番目と 2 番目がともに白玉である」事象は

- $C_n=\text{表}$ かつ $C_{n-1}=\text{表}$

であることと同値である。

コイン投げは，各回独立で表と裏がそれぞれ確率 $1/2$ なので，

$$
\Pr(C_{n-1}=\text{表},\,C_n=\text{表})
=\Pr(C_{n-1}=\text{表})\Pr(C_n=\text{表})
=\frac12\cdot\frac12=\frac14
$$

したがって，求める確率は
$$
\frac14
$$
である。