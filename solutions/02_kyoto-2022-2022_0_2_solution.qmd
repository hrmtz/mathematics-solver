## 解答

(1) 状態の整理と漸化式の設定  
三角柱 $ABC-DEF$ の頂点は，底面 $ABC$，上面 $DEF$ からなる．  
「辺に沿って移動する」とあるので，グラフの頂点を  
- 下側の 3 点 $A,B,C$  
- 上側の 3 点 $D,E,F$  

とし，それぞれの頂点から行ける頂点を整理する．図より，  
- $A$ は $B, C, D$ に接続  
- $B$ は $A, C, E$ に接続  
- $C$ は $A, B, F$ に接続  
- $D$ は $A, E, F$ に接続  
- $E$ は $B, D, F$ に接続  
- $F$ は $C, D, E$ に接続  

である．

$n$ 回移動した後に各頂点にいる経路数を次のようにおく：

- $x_n$：$n$ 回移動した後に $A$ にいる経路数
- $y_n$：$n$ 回移動した後に $B$ にいる経路数
- $z_n$：$n$ 回移動した後に $C$ にいる経路数
- $u_n$：$n$ 回移動した後に $D$ にいる経路数
- $v_n$：$n$ 回移動した後に $E$ にいる経路数
- $w_n$：$n$ 回移動した後に $F$ にいる経路数  

初期条件は，出発点 $P_0 = A$ であるから
$$
x_0 = 1,\quad y_0 = z_0 = u_0 = v_0 = w_0 = 0
$$
である．

各頂点への遷移を数えると，例えば $A$ へは直前に $B,C,D$ にいた場合からだけ来るので  
$$
x_{n+1} = y_n + z_n + u_n
$$
同様にして
$$
\begin{aligned}
y_{n+1} &= x_n + z_n + v_n,\\
z_{n+1} &= x_n + y_n + w_n,\\
u_{n+1} &= x_n + v_n + w_n,\\
v_{n+1} &= y_n + u_n + w_n,\\
w_{n+1} &= z_n + u_n + v_n
\end{aligned}
$$
が得られる．

求めるのは，$n$ 回移動後に $A,B,C$ のいずれかにいる経路数
$$
a_n = x_n + y_n + z_n
$$
である．

(2) 対称性を用いた簡略化  
図形と初期条件から，$B$ と $C$ は対称，$D,E,F$ は 3 点が対称であると考えられる．実際に数式的にも，
- $y_0 = z_0$ かつ $v_0 = w_0$　
から出発しているので，すべての $n$ について
$$
y_n = z_n,\quad v_n = w_n
$$
が成り立つと期待できる．（これを仮定して式を簡略化し，後で矛盾がないことを確認する．）

そこで
$$
b_n = y_n = z_n,\quad c_n = u_n,\quad d_n = v_n = w_n
$$
とおく．すると
$$
a_n = x_n + y_n + z_n = x_n + 2b_n
$$
と表される．

上の遷移式を $x_n,b_n,c_n,d_n$ に書き直す．

まず $x_{n+1}$ については
$$
x_{n+1} = y_n + z_n + u_n = 2b_n + c_n
$$

次に $y_{n+1}$ は
$$
y_{n+1} = x_n + z_n + v_n = x_n + b_n + d_n
$$
だが，$y_{n+1} = b_{n+1}$ なので
$$
b_{n+1} = x_n + b_n + d_n
$$

$u_{n+1}$ は
$$
u_{n+1} = x_n + v_n + w_n = x_n + 2d_n
$$
すなわち
$$
c_{n+1} = x_n + 2d_n
$$

$v_{n+1}$ は
$$
v_{n+1} = y_n + u_n + w_n = b_n + c_n + d_n
$$
よって
$$
d_{n+1} = b_n + c_n + d_n
$$

初期条件は
$$
x_0 = 1,\quad b_0 = 0,\quad c_0 = 0,\quad d_0 = 0
$$
である．

(3) $a_n$ のみに関する漸化式の導出  
$a_n = x_n + 2b_n$ より
$$
a_{n+1} = x_{n+1} + 2b_{n+1}
= (2b_n + c_n) + 2(x_n + b_n + d_n)
= 2x_n + 4b_n + c_n + 2d_n
$$
ここで $x_n + 2b_n = a_n$ なので
$$
2x_n + 4b_n = 2(x_n + 2b_n) = 2a_n
$$
だから
$$
a_{n+1} = 2a_n + (c_n + 2d_n)
$$

一方，$c_{n+1}$ の式から
$$
c_{n+1} = x_n + 2d_n
$$
であるので，これに $b_n$ を加えると
$$
b_n + c_{n+1} = x_n + b_n + 2d_n
$$
右辺を $a_{n+1}$ の式と比較する．  
先ほどの
$$
a_{n+1} = 2a_n + c_n + 2d_n
$$
で $c_n = x_{n-1} + 2d_{n-1}$ を用いながら進めるのは煩雑であるので，別の量を導入して簡単にする．

ここで
$$
s_n = x_n + b_n + c_n + d_n
$$
とおく．これは「$n$ 回移動後に $A,B,C,D,E,F$ のうち，上面 $D,E,F$ を含めた全部のうち，$A,B,C,D,E,F$ のうち $A,B,C,D,E,F$（実際には 6 頂点全体）のうち，$A,B,C,D,E,F$ の 4 種類 $A,B,C,D,E,F$ のうち，$A,B,C,D,E,F$ のうち，$A,B,C,D,E,F$ のうち，$A,B,C,D,E,F$ のうちの $A,B,C,D,E,F$ を数える」ことに対応しているが，ここでは単に計算を簡単にするための補助量である．（実際には $y_n = z_n = b_n,\; v_n = w_n = d_n$ より，全頂点にいる経路数の総和は $x_n + 2b_n + c_n + 2d_n$ であり，$s_n$ はその一部である．）

遷移式から
$$
\begin{aligned}
x_{n+1} + b_{n+1} + c_{n+1} + d_{n+1}
&= (2b_n + c_n) + (x_n + b_n + d_n) + (x_n + 2d_n) + (b_n + c_n + d_n)\\
&= 2x_n + 4b_n + 2c_n + 4d_n
\end{aligned}
$$
したがって
$$
s_{n+1} = 2x_n + 4b_n + 2c_n + 4d_n
= 2(x_n + 2b_n) + 2(c_n + 2d_n)
= 2a_n + 2(c_n + 2d_n)
$$
一方，$a_{n+1} = 2a_n + (c_n + 2d_n)$ であったから，
$$
s_{n+1} = 2a_{n+1}
$$
が得られる．

また，$s_n$ の定義と $a_n = x_n + 2b_n$ を比べると
$$
s_n = x_n + b_n + c_n + d_n
= (x_n + 2b_n) - b_n + c_n + d_n
= a_n - b_n + c_n + d_n
$$
となるが，ここから直接 $a_n$ だけの式を求めるよりも，$s_n$ がきれいな挙動をするかを調べる方が有利である．

実は，すべての頂点への総数を $T_n$ とおくと，どの頂点からも次へは 3 通りの辺で出て行くので，
$$
T_{n+1} = 3T_n
$$
が成り立つ．初期条件 $T_0 = 1$（最初は $A$ に 1 通りだけ）より
$$
T_n = 3^n
$$
である．

全頂点への総数 $T_n$ は
$$
T_n = x_n + 2b_n + c_n + 2d_n = a_n + (c_n + 2d_n)
$$
一方，
$$
s_n = x_n + b_n + c_n + d_n
= (x_n + 2b_n) + (c_n + 2d_n) - (b_n + d_n)
= a_n + (c_n + 2d_n) - (b_n + d_n)
$$
であるが，ここで $b_n + d_n$ の具体的な追跡は不要である．重要なのは，前に得た
$$
s_{n+1} = 2a_{n+1}
$$
と，$T_n = 3^n$ および
$$
T_n = a_n + (c_n + 2d_n)
$$
の関係から，$a_n$ のみの漸化式を取り出せることである．

さて，$T_n = a_n + (c_n + 2d_n)$ だから
$$
c_n + 2d_n = T_n - a_n = 3^n - a_n
$$
これを $a_{n+1} = 2a_n + (c_n + 2d_n)$ に代入すると
$$
a_{n+1} = 2a_n + (3^n - a_n) = a_n + 3^n
$$
よって，$a_n$ は
$$
a_{n+1} = a_n + 3^n
$$
という一次の漸化式をみたす．

初期条件は $n=0$ のとき
$$
a_0 = x_0 + y_0 + z_0 = 1 + 0 + 0 = 1
$$
である．

(4) 漸化式の解法  
$$
a_{n+1} = a_n + 3^n,\quad a_0 = 1
$$
を解く．これは等差型の非斉次一次漸化式であり，和をとって
$$
a_n = a_0 + \sum_{k=0}^{n-1} 3^k
$$
となるから，
$$
\sum_{k=0}^{n-1} 3^k = \frac{3^n - 1}{3 - 1} = \frac{3^n - 1}{2}
$$
より
$$
a_n = 1 + \frac{3^n - 1}{2} = \frac{3^n + 1}{2}
$$
となる．

したがって，$A$ を始点として辺に沿って $n$ 回移動し，終点が $A,B,C$ のいずれかとなる経路の総数 $a_n$ は
$$
\boxed{a_n = \dfrac{3^n + 1}{2}}
$$
である．