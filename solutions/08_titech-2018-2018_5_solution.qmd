## 解答

(1)  
立方体の8頂点を  
$A(0,0,0),\ B(1,1,0),\ C(1,0,1),\ D(0,1,1)$ と，それぞれに対して座標の符号（偶奇）が逆になる  
$A'(1,1,1),\ B'(0,0,1),\ C'(0,1,0),\ D'(1,0,0)$  
の4頂点を考える．$A',B',C',D'$ に $a_n',b_n',c_n',d_n'$ を対応させると，頂点の隣接関係は

- $A$ の隣 → $C',D',B'$  
- $B$ の隣 → $C',D',A'$  
- $C$ の隣 → $B',D',A'$  
- $D$ の隣 → $B',C',A'$

- $A'$ の隣 → $C,D,B$  
- $B'$ の隣 → $C,D,A$  
- $C'$ の隣 → $B,D,A$  
- $D'$ の隣 → $B,C,A$

である．

$x$ 軸方向に進むときは $p$，$y$ 軸方向は $q$，$z$ 軸方向は $r$ の確率で選ぶので，例えば $A\to C'$ (＝$z$ 軸方向) の確率は $r$ などと分かる．  
そこで，$n+1$ 秒後の確率と $n$ 秒後の確率の関係は次のようになる：

$$
\begin{aligned}
a_{n+1} &= r\,c_n' + q\,d_n' + p\,b_n',\\
b_{n+1} &= r\,c_n' + q\,d_n' + p\,a_n',\\
c_{n+1} &= r\,b_n' + q\,d_n' + p\,a_n',\\
d_{n+1} &= r\,b_n' + q\,c_n' + p\,a_n',
\end{aligned}
$$

$$
\begin{aligned}
a_{n+1}' &= r\,c_n + q\,d_n + p\,b_n,\\
b_{n+1}' &= r\,c_n + q\,d_n + p\,a_n,\\
c_{n+1}' &= r\,b_n + q\,d_n + p\,a_n,\\
d_{n+1}' &= r\,b_n + q\,c_n + p\,a_n.
\end{aligned}
$$

ここで，初期状態が $A$ であることから，$n$ の偶奇により  
偶数秒後は $A,B,C,D$ 上にしかいられず，奇数秒後は $A',B',C',D'$ 上にしかいられない．  
すなわち  
- $n$ が偶数のとき：$a_n',b_n',c_n',d_n'=0$，  
- $n$ が奇数のとき：$a_n,b_n,c_n,d_n=0$  
である．

したがって，$n$ と $n+2$ は同じ偶奇なので，$a_{n+2}$ を求めるときには中間の $(n+1)$ 秒後は必ず「反対側」の4頂点上にある．  
$n$ が偶数の場合を例に書くと，$n$ 秒後に $A,B,C,D$ 上にいる確率を用いて

$$
\begin{aligned}
a_{n+1}' &= r\,c_n + q\,d_n + p\,b_n,\\
b_{n+1}' &= r\,c_n + q\,d_n + p\,a_n,\\
c_{n+1}' &= r\,b_n + q\,d_n + p\,a_n,\\
d_{n+1}' &= r\,b_n + q\,c_n + p\,a_n
\end{aligned}
$$

となり，さらに $n+1$ 秒後から $n+2$ 秒後への遷移により

$$
a_{n+2} = r\,c_{n+1}' + q\,d_{n+1}' + p\,b_{n+1}' 
$$

であるから，これに上の式を代入して整理すると

$$
\begin{aligned}
a_{n+2}
&= r(r\,b_n + q\,d_n + p\,a_n)
 + q(r\,b_n + q\,c_n + p\,a_n)
 + p(r\,c_n + q\,d_n + p\,b_n)\\
&= (p^2+q^2+r^2)\,a_n
 + (p^2+2qr)\,b_n
 + (2pr+q^2)\,c_n
 + (2pq+r^2)\,d_n
\end{aligned}
$$

を得る．

(2)  
$a_n-b_n+c_n-d_n$ を $s_n$ とおく：

$$
s_n = a_n - b_n + c_n - d_n.
$$

(1) で得た $a_{n+2}$ と同様に，$b_{n+2},c_{n+2},d_{n+2}$ を $a_n,b_n,c_n,d_n$ で表すと，計算により

$$
\begin{aligned}
b_{n+2}
&= (p^2+q^2+r^2)\,b_n
 + (p^2+2qr)\,a_n
 + (2pq+r^2)\,c_n
 + (2pr+q^2)\,d_n,\\[2mm]
c_{n+2}
&= (p^2+q^2+r^2)\,c_n
 + (p^2+2qr)\,d_n
 + (2pr+q^2)\,a_n
 + (2pq+r^2)\,b_n,\\[2mm]
d_{n+2}
&= (p^2+q^2+r^2)\,d_n
 + (p^2+2qr)\,c_n
 + (2pq+r^2)\,a_n
 + (2pr+q^2)\,b_n.
\end{aligned}
$$

これらを用いて

$$
s_{n+2} = a_{n+2} - b_{n+2} + c_{n+2} - d_{n+2}
$$

を計算すると，項ごとに係数を整理して

$$
s_{n+2} = (1-2p)\,s_n
$$

となる．（$p+q+r=1$ を用いて $p^2+q^2+r^2-2pq-2pr+2qr = 1-2p$ が得られる．）

初期条件は  
- $n=0$：位置は必ず $A$ なので $a_0=1,\ b_0=c_0=d_0=0$．したがって
  $$s_0 = 1-0+0-0 = 1.$$
- $n=1$：$A$ から1回動くと $A$ 上にはいられず，$B,C,D$ のいずれか1点にあり，各方向の確率から
  $$b_1= q,\ c_1=r,\ d_1=p,\ a_1=0.$$
  したがって
  $$s_1 = 0 - q + r - p = r - p - q = 2r - 1 \quad(p+q+r=1).$$

漸化式は2刻みなので，偶数と奇数で分けて解く：

- $n=2k$（偶数）のとき  
  $s_{2}=(1-2p)s_0$，$s_4=(1-2p)s_2,\dots$ から
  $$s_{2k} = (1-2p)^k.$$

- $n=2k+1$（奇数）のとき  
  $s_3=(1-2p)s_1$，$s_5=(1-2p)s_3,\dots$ より
  $$s_{2k+1} = (1-2p)^k s_1 = (2r-1)(1-2p)^k.$$

したがって，

$$
a_n - b_n + c_n - d_n =
\begin{cases}
(1-2p)^{\frac{n}{2}}, & n\ \text{偶数},\\[1mm]
(2r-1)(1-2p)^{\frac{n-1}{2}}, & n\ \text{奇数}.
\end{cases}
$$

(3)  
$a_n$ を求める．まず，全確率より

$$
a_n + b_n + c_n + d_n = 1 \quad(n\ \text{偶数}),\qquad
a_n + b_n + c_n + d_n = 0 \quad(n\ \text{奇数}).
$$

また，立方体の対称性と遷移の対称性（$x,y,z$ 方向に進む確率は p,q,r で固定であり，3本の軸に関して等質な構造をもつこと）から，  
$n$ 秒後に「座標和が偶数の頂点」にいる確率を $E_n$，「座標和が奇数の頂点」にいる確率を $O_n$ とおくと，今回注目している4頂点 $A,B,C,D$ はいずれも偶数和の頂点であるため

$$
E_n = a_n + b_n + c_n + d_n.
$$

さらに，偶数和頂点4個は互いに対称なので，その中での確率は常に等しくなる．したがって

$$
a_n = b_n = c_n = d_n \quad(n\ \text{偶数})
$$

が成り立つ．よって，$n$ 偶数のとき

$$
a_n = b_n = c_n = d_n = \frac{E_n}{4}.
$$

しかし，問題(2)で求めた $s_n = a_n-b_n+c_n-d_n$ は，上の対称性から $n$ 偶数では

$$
s_n = a_n - a_n + a_n - a_n = 0
$$

となるので，(2)の結果から

$$
0 = s_{2k} = (1-2p)^k
$$

が常に成り立つわけではない．  
よって，「4頂点間で常に等確率になる」とは限らないことが分かる．  
ここで，別の方法を用いる。

4頂点 $A,B,C,D$ の組に対する状態ベクトル

$$
v_n = \begin{pmatrix}a_n\\ b_n\\ c_n\\ d_n\end{pmatrix}
$$

の2ステップ後への遷移は，(1) の結果より

$$
v_{n+2} = M v_n,
$$

ただし

$$
M = \begin{pmatrix}
p^2+q^2+r^2 & p^2+2qr   & 2pr+q^2 & 2pq+r^2\\
p^2+2qr     & p^2+q^2+r^2 & 2pq+r^2 & 2pr+q^2\\
2pr+q^2     & 2pq+r^2   & p^2+q^2+r^2 & p^2+2qr\\
2pq+r^2     & 2pr+q^2   & p^2+2qr   & p^2+q^2+r^2
\end{pmatrix}
$$

である．  
この行列 $M$ の固有ベクトルとして

$$
u_1=\begin{pmatrix}1\\1\\1\\1\end{pmatrix},\ 
u_2=\begin{pmatrix}1\\-1\\1\\-1\end{pmatrix},\ 
u_3=\begin{pmatrix}1\\1\\-1\\-1\end{pmatrix},\ 
u_4=\begin{pmatrix}1\\-1\\-1\\1\end{pmatrix}
$$

を考えると，直計算により

$$
M u_1 = u_1,\quad
M u_2 = (1-2p)\,u_2,\quad
M u_3 = (1-2q)\,u_3,\quad
M u_4 = (1-2r)\,u_4
$$

が成り立つ（$p+q+r=1$ を用いた多項式整理を行う）．

初期状態は $v_0 = (1,0,0,0)^T$ なので，これを $u_1,\dots,u_4$ の線形結合に分解する．

$$
v_0 = \alpha_1 u_1 + \alpha_2 u_2 + \alpha_3 u_3 + \alpha_4 u_4.
$$

成分を書き下すと

$$
\begin{aligned}
1 &= \alpha_1 + \alpha_2 + \alpha_3 + \alpha_4,\\
0 &= \alpha_1 - \alpha_2 + \alpha_3 - \alpha_4,\\
0 &= \alpha_1 + \alpha_2 - \alpha_3 - \alpha_4,\\
0 &= \alpha_1 - \alpha_2 - \alpha_3 + \alpha_4.
\end{aligned}
$$

これは対称な連立一次方程式であり，解くと

$$
\alpha_1 = \alpha_2 = \alpha_3 = \alpha_4 = \frac14
$$

を得る．

よって

$$
v_0 = \frac14(u_1+u_2+u_3+u_4).
$$

$n$ 偶数，$n=2k$ のときは $v_{2k} = M^k v_0$ だから，

$$
\begin{aligned}
v_{2k}
&= M^k v_0
 = \frac14\left(M^k u_1 + M^k u_2 + M^k u_3 + M^k u_4\right)\\
&= \frac14\left(u_1 + (1-2p)^k u_2 + (1-2q)^k u_3 + (1-2r)^k u_4\right).
\end{aligned}
$$

ここで $v_{2k}$ の第1成分が $a_{2k}$ であるから，$u_1,u_2,u_3,u_4$ の第1成分はいずれも 1 であることを用いると

$$
a_{2k}
= \frac14\left(1 + (1-2p)^k + (1-2q)^k + (1-2r)^k\right)
$$

となる．

$n$ が奇数のときは，頂点 $A,B,C,D$ には到達できないので

$$
a_{2k+1} = 0.
$$

以上をまとめると，

$$
a_n =
\begin{cases}
\displaystyle \frac14\Bigl\{1 + (1-2p)^{\frac{n}{2}}
 + (1-2q)^{\frac{n}{2}} + (1-2r)^{\frac{n}{2}}\Bigr\}, & n\ \text{偶数},\\[3mm]
0, & n\ \text{奇数}.
\end{cases}
$$